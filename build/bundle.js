module.exports=function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={exports:{},id:o,loaded:!1};return e[o].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="/build/",t(0)}([function(e,t,n){(function(t){"use strict";function o(e,n){var o=e.webtaskContext,u=["AUTH0_DOMAIN","AUTH0_GLOBAL_CLIENT_ID","AUTH0_GLOBAL_CLIENT_SECRET","WEBHOOK_URL"],l=u.filter(function(e){return!o.data[e]});return l.length?n.status(400).send({message:"Missing settings: "+l.join(", ")}):void e.webtaskContext.storage.get(function(u,l){if(u&&404!==u.output.statusCode)return n.status(u.code).send(u);var a="undefined"==typeof l?null:l.checkpointId,c=new r({domain:o.data.AUTH0_DOMAIN,clientID:o.data.AUTH0_GLOBAL_CLIENT_ID,clientSecret:o.data.AUTH0_GLOBAL_CLIENT_SECRET});s.waterfall([function(e){console.log("STEP 1: Getting access token"),c.getAccessToken(function(t){return t&&console.log("Error authenticating:",t),e(t)})},function(e){console.log("STEP 2: Downloading logs");var n=function o(n){console.log("Downloading logs from: "+(n.checkpointId||"Start")+"."),n.logs=n.logs||[],c.getLogs({take:200,from:n.checkpointId},function(r,i){return r?e(r):i&&i.length?(i.forEach(function(e){return n.logs.push(e)}),n.checkpointId=n.logs[n.logs.length-1]._id,t(function(){return o(n)})):(console.log("Total logs: "+n.logs.length+"."),e(null,n))})};n({checkpointId:a})},function(e,t){console.log("STEP 3: Filtering logs");var n=o.data.AUTH0_API_ENDPOINTS.split(","),r=function(e){return n&&n.length?e.details.request&&e.details.request.path&&n.some(function(t){return e.details.request.path==="/api/v2/"+t||e.details.request.path.indexOf("/api/v2/"+t+"/")>=0}):!0};e.logs=e.logs.filter(function(e){return"sapi"===e.type||"fapi"===e.type}).filter(r).map(function(e){return{date:e.date,request:e.details.request,response:e.details.response}}),o.data.AUTH0_API_ENDPOINTS&&console.log("Filtered logs on '"+o.data.AUTH0_API_ENDPOINTS+"': "+e.logs.length+"."),t(null,e)},function(e,t){if(console.log("STEP 4: Sending information"),!e.logs.length)return t(null,e);var n=o.data.WEBHOOK_URL,r=o.data.WEBHOOK_CONCURRENT_CALLS||5;console.log("Sending to '"+n+"' with "+r+" concurrent calls."),s.eachLimit(e.logs,r,function(e,t){i.post(n).send(e).set("Content-Type","application/json").end(function(e,n){return e?(console.log("Error sending request:",e),t(e)):n.ok?void t():(console.log("Unexpected response while sending request:",JSON.stringify(n.body)),t(new Error("Unexpected response from webhook.")))})},function(n){return n?t(n):(console.log("Upload complete."),t(null,e))})}],function(t,o){return t?(console.log("Job failed."),e.webtaskContext.storage.set({checkpointId:a},{force:1},function(e){return e?n.status(500).send(e):void n.status(500).send({error:t})})):(console.log("Job complete."),e.webtaskContext.storage.set({checkpointId:o.checkpointId,totalLogsProcessed:o.logs.length},{force:1},function(e){return e?n.status(500).send(e):void n.sendStatus(200)}))})})}var r=n(3),i=n(4),s=n(5),u=n(6),l=n(7),a=u();a.get("/",o),a.post("/",o),e.exports=l.fromExpress(a)}).call(t,n(1).setImmediate)},function(e,t,n){(function(e,o){function r(e,t){this._id=e,this._clearFn=t}var i=n(2).nextTick,s=Function.prototype.apply,u=Array.prototype.slice,l={},a=0;t.setTimeout=function(){return new r(s.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new r(s.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e.close()},r.prototype.unref=r.prototype.ref=function(){},r.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},t.setImmediate="function"==typeof e?e:function(e){var n=a++,o=arguments.length<2?!1:u.call(arguments,1);return l[n]=!0,i(function(){l[n]&&(o?e.apply(null,o):e.call(null),t.clearImmediate(n))}),n},t.clearImmediate="function"==typeof o?o:function(e){delete l[e]}}).call(t,n(1).setImmediate,n(1).clearImmediate)},function(e,t){function n(){a=!1,s.length?l=s.concat(l):c=-1,l.length&&o()}function o(){if(!a){var e=setTimeout(n);a=!0;for(var t=l.length;t;){for(s=l,l=[];++c<t;)s&&s[c].run();c=-1,t=l.length}s=null,a=!1,clearTimeout(e)}}function r(e,t){this.fun=e,this.array=t}function i(){}var s,u=e.exports={},l=[],a=!1,c=-1;u.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new r(e,t)),1!==l.length||a||setTimeout(o,0)},r.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=i,u.addListener=i,u.once=i,u.off=i,u.removeListener=i,u.removeAllListeners=i,u.emit=i,u.binding=function(e){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(e){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},function(e,t){e.exports=require("auth0@0.8.2")},function(e,t){e.exports=require("superagent")},function(e,t){e.exports=require("async")},function(e,t){e.exports=require("express")},function(e,t,n){function o(e){return function(t,n,o){var r=s(n.x_wt.jtn);return n.originalUrl=n.url,n.url=n.url.replace(r,"/"),n.webtaskContext=u(t),e(n,o)}}function r(e){var t;return e.ext("onRequest",function(e,n){var o=s(e.x_wt.jtn);e.setUrl(e.url.replace(o,"/")),e.webtaskContext=t}),function(n,o,r){var i=e._dispatch();t=u(n),i(o,r)}}function i(e){return function(t,n,o){var r=s(n.x_wt.jtn);return n.originalUrl=n.url,n.url=n.url.replace(r,"/"),n.webtaskContext=u(t),e.emit("request",n,o)}}function s(e){var t="^/api/run/[^/]+/",n="(?:[^/?#]*/?)?";return new RegExp(t+(e?n:""))}function u(e){function t(e,t,o){var r=n(8);"function"==typeof t&&(o=t,t={}),o(r.preconditionFailed("Storage is not available in this context"))}function o(t,o,r){var i=n(8),s=n(9);"function"==typeof o&&(r=o,o={}),s({uri:e.secrets.EXT_STORAGE_URL,method:"GET",headers:o.headers||{},qs:{path:t},json:!0},function(e,t,n){return e?r(i.wrap(e,502)):404===t.statusCode&&Object.hasOwnProperty.call(o,"defaultValue")?r(null,o.defaultValue):t.statusCode>=400?r(i.create(t.statusCode,n&&n.message)):void r(null,n)})}function r(e,t,o,r){var i=n(8);"function"==typeof o&&(r=o,o={}),r(i.preconditionFailed("Storage is not available in this context"))}function i(t,o,r,i){var s=n(8),u=n(9);"function"==typeof r&&(i=r,r={}),u({uri:e.secrets.EXT_STORAGE_URL,method:"PUT",headers:r.headers||{},qs:{path:t},body:o},function(e,t,n){return e?i(s.wrap(e,502)):t.statusCode>=400?i(s.create(t.statusCode,n&&n.message)):void i(null)})}return e.read=e.secrets.EXT_STORAGE_URL?o:t,e.write=e.secrets.EXT_STORAGE_URL?i:r,e}t.fromConnect=t.fromExpress=o,t.fromHapi=r,t.fromServer=t.fromRestify=i},function(e,t){e.exports=require("boom")},function(e,t){e.exports=require("request")}]);